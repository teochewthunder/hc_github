<!DOCTYPE html>
<html>
	<head>
		<title>Line Chart</title>

		<style>
			#container
			{
				width: 100%;
				height: 600px;
			}

			#dashboard
			{
				width: 100%;
				height: 100px;
				text-align: center;
			}

			label
			{
				display: inline-block;
				width: 20em;
				font-family: verdana;
				color: rgba(200, 0, 0, 1);
				text-align: right;
			}
		</style>

		<script src="https://code.highcharts.com/highcharts.js"></script>

		<script>
			document.addEventListener("DOMContentLoaded", function () {
				fetch("http://www.teochewthunder.com/demo/hc_github/hcdata_github.csv")
			    .then(response => response.text())
			    .then(csvData => {
			        const rows = csvData.split("\n");
			        currentData = rows.slice(1).map(row => {
		            	const cols = row.split(",");
		            	var year = parseInt(cols[0]);
		            	var month = parseInt(cols[1]);
		            	var contributions = parseInt(cols[2]);

		            	return [year, month, contributions];
		        	});

		        	var years = currentData.map(col => col[0]);
					var yearMin = Math.min(...years);
					var yearMax = Math.max(...years);

					var yearSeries = [];
					for (var i = yearMin; i <= yearMax; i++)
					{
						yearSeries[i] = currentData.filter((x) => { return x[0] == i; });
					}

			    	var yearFrom = yearMin;
					var yearTo = yearMin;

		    		var rngYearFrom = document.getElementById("rngYearFrom");
		    		var rngYearTo = document.getElementById("rngYearTo");
			    	var opYearFrom = document.getElementById("opYearFrom");
			    	var opYearTo = document.getElementById("opYearTo");
		    		var yearFrom = parseInt(rngYearFrom.value);
					var yearTo = parseInt(rngYearTo.value);

		    		rngYearFrom.min = yearMin;
		    		rngYearFrom.max = yearMax;
		    		rngYearFrom.value = yearFrom;
					opYearFrom.value = yearFrom;

		    		rngYearTo.min = yearMin;
		    		rngYearTo.max = yearMax;
		    		rngYearTo.value = yearTo;
					opYearTo.value = yearTo;

			        renderLineChart();	
			    });			
		    });

		    function renderLineChart()
		    {
		    	var rngYearFrom = document.getElementById("rngYearFrom");
		    	var rngYearTo = document.getElementById("rngYearTo");
		    	var yearFrom = parseInt(rngYearFrom.value);
				var yearTo = parseInt(rngYearTo.value);

				var dataset = currentData.filter((x) =>{ return parseInt(x[0]) >= yearFrom && parseInt(x[0]) <= yearTo});

				var years = dataset.map(col => col[0]);
				var commits = dataset.map(col => col[2]);
console.log(commits)
		        const chart = Highcharts.chart("container", {
		            chart: 
		            {
		                borderColor: "rgba(250, 100, 0, 1)",
		                borderRadius: 10,
		                borderWidth: 2,
		            },
		            title: 
		            {
		                text: "My Contributions",
		                style: { "color": "rgba(250, 100, 0, 1)", "font-size": "2.5em", "font-weight": "bold" }
		            },
		            subtitle: 
		            {
		                text: "GitHub statistics by TeochewThunder",
		                style: { "color": "rgba(250, 100, 0, 0.8)", "font-size": "0.8em" }
		            },
		            xAxis: 
		            {
		                categories: years
		            },
		            yAxis: 
		            {
		                title: 
		                {
		                    text: "Commits"
		                },
		                gridLineColor: "rgba(250, 100, 0, 0.2)",
		                tickColor: "rgba(250, 100, 0, 0.2)"
		            },
		            series:
		            [
/*				    	{
			                name: "commits",
			                type: "spline",
			                data: commits,
					        lineColor: "rgba(250, 100, 0, 1)",
					        lineWidth: 5,
					        dashStyle: "Solid",
					        marker: 
					        {
						        fillColor: "rgba(250, 100, 0, 1)"
					        }
			            }*/
						{
			                name: "2020",
			                type: "spline",
			                data: yearSeries[2020],
					        lineColor: "rgba(250, 100, 0, 0.5)",
					        lineWidth: 5,
					        dashStyle: "Solid",
					        marker: 
					        {
						        fillColor: "rgba(250, 100, 0, 0.5)"
					        }
			            },
						{
			                name: "2021",
			                type: "spline",
			                data: yearSeries[2021],
					        lineColor: "rgba(250, 100, 0, 0.5)",
					        lineWidth: 5,
					        dashStyle: "Solid",
					        marker: 
					        {
						        fillColor: "rgba(250, 100, 0, 0.5)"
					        }
			            }
		            ]
		    	});
		    }

		    function setYear(target) 
		    {
		    	var rngYearFrom = document.getElementById("rngYearFrom");
		    	var rngYearTo = document.getElementById("rngYearTo");
		    	var opYearFrom = document.getElementById("opYearFrom");
		    	var opYearTo = document.getElementById("opYearTo");
		    	var yearFrom = parseInt(rngYearFrom.value);
				var yearTo = parseInt(rngYearTo.value);

				if (target == "from")
				{
					if (yearFrom > yearTo)
					{
						yearTo = yearFrom;
						rngYearTo.value = yearFrom;
						opYearTo.value = yearFrom;
					}

					opYearFrom.value = yearFrom;
				}
				else
				{
					if (yearTo < yearFrom)
					{
						yearFrom = yearTo;
						rngYearFrom.value = yearTo;
						opYearFrom.value = yearTo;
					}		

					opYearTo.value = yearTo;			
				}

				renderLineChart();
		    }

		    let currentData = [];
		</script>
	</head>

	<body>
		<div id="container">

		</div>

		<div id="dashboard">
			<label for="rngYearFrom">
				FROM
				<input id="rngYearFrom" type="range" min="2015" max="2025" oninput="setYear('from')" />
				<output id="opYearFrom" for="rngYearFrom"></output>
			</label>
			<br />
			<label for="rngYearTo">
				TO
				<input id="rngYearTo" type="range" min="2015" max="2025" oninput="setYear('to')" />
				<output id="opYearTo" for="rngYearTo"></output>
			</label>			
		</div>
	</body>

</html>
